<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Meta Tags untuk WhatsApp & Media Sosial (Open Graph) -->
    <title>Smart Kamus Arab Indo Az-Zawawi v1</title>
    <meta name="description" content="Kuasai Bahasa Arab dengan AI: Kamus Digital, Bedah Nahwu Sharaf, dan Tantangan Game Edukasi Interaktif v1.">
    <meta property="og:title" content="Smart Kamus Arab Indo Az-Zawawi v1 - Arena Tantangan AI">
    <meta property="og:description" content="Ayo uji kemampuan Bahasa Arabmu! Hadapi tantangan kuis Nahwu, Sharaf, dan Kosakata yang dibangkitkan cerdas oleh AI.">
    <!-- FIX: Gambar logo teks khusus bertema hijau elegan untuk Preview Link WA -->
    <meta property="og:image" content="https://placehold.co/1200x630/022c22/34d399.png?text=Smart+Kamus+Az-Zawawi+v1">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/png">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://az-zawawi-kamus.ai">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Smart Kamus Arab Indo Az-Zawawi v1">
    <meta property="twitter:description" content="Kamus Cerdas dengan fitur Bedah Kalimat & Game Edukasi.">
    <meta property="twitter:image" content="https://placehold.co/1200x630/022c22/34d399.png?text=Smart+Kamus+Az-Zawawi+v1">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .arabic-font { font-family: 'Amiri', serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); }
        @keyframes slideIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide { animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        .loader-dots div { animation-timing-function: cubic-bezier(0, 1, 1, 0); }
        .loader-dots div:nth-child(1) { left: 8px; animation: dots1 0.6s infinite; }
        .loader-dots div:nth-child(2) { left: 8px; animation: dots2 0.6s infinite; }
        .loader-dots div:nth-child(3) { left: 32px; animation: dots2 0.6s infinite; }
        .loader-dots div:nth-child(4) { left: 56px; animation: dots3 0.6s infinite; }
        @keyframes dots1 { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        @keyframes dots3 { 0% { transform: scale(1); } 100% { transform: scale(0); } }
        @keyframes dots2 { 0% { transform: translate(0, 0); } 100% { transform: translate(24px, 0); } }

        .card-custom { border-radius: 2.5rem; box-shadow: 0 10px 30px -5px rgba(0,0,0,0.05); }
    </style>
</head>
<body class="text-slate-900 min-h-screen flex flex-col">

    <div class="max-w-3xl mx-auto px-4 pt-8 pb-12 flex-grow w-full">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-extrabold text-emerald-950 tracking-tight leading-tight">
                Smart Kamus Arab Indo <span class="text-emerald-500 block sm:inline">Az-Zawawi <small class="text-sm font-bold text-slate-400">v1</small></span>
            </h1>
            
            <nav class="flex flex-wrap justify-center gap-2 mt-8">
                <button onclick="switchMode('dictionary')" id="btnNavDict" class="px-6 py-2.5 rounded-xl text-[10px] font-black transition-all bg-emerald-600 text-white shadow-lg uppercase tracking-widest">Kamus</button>
                <button onclick="switchMode('analysis')" id="btnNavAnalysis" class="px-6 py-2.5 rounded-xl text-[10px] font-black transition-all bg-white text-emerald-800 border border-emerald-100 uppercase tracking-widest">Bedah Kalimat</button>
                <button onclick="switchMode('game')" id="btnNavGame" class="px-6 py-2.5 rounded-xl text-[10px] font-black transition-all bg-white text-emerald-800 border border-emerald-100 uppercase tracking-widest">Permainan</button>
                <button onclick="switchMode('help')" id="btnNavHelp" class="px-6 py-2.5 rounded-xl text-[10px] font-black transition-all bg-white text-emerald-800 border border-emerald-100 uppercase tracking-widest">Bantuan</button>
            </nav>
        </header>

        <main id="mainContent">
            <!-- MODE: KAMUS -->
            <section id="dictionarySection" class="space-y-6">
                <div class="sticky top-4 z-40">
                    <div class="relative group rounded-full shadow-xl overflow-hidden ring-4 ring-emerald-50 focus-within:ring-emerald-400 transition-all">
                        <input 
                            type="text" 
                            id="searchInput" 
                            placeholder="Cari (Indo / Arab)..." 
                            class="w-full p-6 pl-14 pr-16 border-none focus:outline-none transition-all text-lg glass"
                        >
                        <div class="absolute left-6 top-1/2 -translate-y-1/2 text-emerald-600 pointer-events-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                        </div>
                        <button id="clearSearchBtn" onclick="clearSearch()" class="hidden absolute right-6 top-1/2 -translate-y-1/2 bg-slate-100 hover:bg-red-50 text-slate-400 hover:text-red-500 p-2 rounded-full transition-all">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                        </button>
                    </div>
                </div>
                <div id="aiStatus" class="hidden flex flex-col items-center justify-center py-10">
                    <div class="relative w-16 h-6 loader-dots"><div class="absolute top-0 w-3 h-3 rounded-full bg-emerald-500"></div><div class="absolute top-0 w-3 h-3 rounded-full bg-emerald-500"></div><div class="absolute top-0 w-3 h-3 rounded-full bg-emerald-500"></div><div class="absolute top-0 w-3 h-3 rounded-full bg-emerald-500"></div></div>
                    <p class="text-emerald-800 text-[10px] font-black mt-3 animate-pulse tracking-[0.3em] uppercase">Memproses Data Bahasa...</p>
                </div>
                <div id="resultArea" class="space-y-6"></div>
                <div id="emptyState" class="text-center py-20 opacity-30">
                    <div class="text-7xl mb-4 text-emerald-950/20">üìö</div>
                    <p class="text-slate-900 font-bold text-lg uppercase tracking-wider">Kamus Az-Zawawi v1</p>
                    <p class="text-slate-500 text-xs italic mt-1">Gunakan kata kunci untuk mencari makna</p>
                </div>
            </section>

            <!-- MODE: BEDAH KALIMAT -->
            <section id="analysisSection" class="hidden animate-slide">
                <div class="bg-white p-7 card-custom border border-emerald-50">
                    <div class="text-center mb-8">
                        <div class="w-14 h-14 bg-emerald-50 text-emerald-600 rounded-2xl flex items-center justify-center mx-auto text-2xl mb-3 text-emerald-600">üî¨</div>
                        <h2 class="text-xl font-black text-slate-900 uppercase tracking-tighter">Analisis Kalimat</h2>
                        <p class="text-slate-400 text-[10px] font-bold uppercase tracking-widest mt-1 text-center">Bedah Struktur linguistik & Nahwu Sharaf</p>
                    </div>
                    <div class="space-y-4">
                        <div class="relative rounded-[2rem] overflow-hidden border-2 border-emerald-50 focus-within:border-emerald-500 transition-all">
                            <textarea id="sentenceInput" placeholder="Tulis kalimat Indonesia (baku/gaul) atau Arab di sini..." class="w-full h-44 p-8 pr-16 border-none focus:outline-none transition-all text-xl resize-none shadow-inner bg-slate-50 font-medium"></textarea>
                            <button onclick="document.getElementById('sentenceInput').value = ''; document.getElementById('analysisResults').classList.add('hidden');" class="absolute top-6 right-6 bg-slate-200 p-2 rounded-full text-slate-500 hover:text-red-600 transition-all"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                        </div>
                        <button onclick="analyzeSentence()" id="btnAnalyze" class="w-full py-5 bg-emerald-600 text-white rounded-[2rem] font-black text-xs uppercase tracking-widest shadow-lg hover:bg-emerald-700 transition-all"><span>Mulai Bedah Kalimat</span></button>
                    </div>
                    <div id="analysisLoader" class="hidden flex flex-col items-center justify-center py-16">
                        <div class="relative w-16 h-6 loader-dots"><div class="absolute top-0 w-3 h-3 rounded-full bg-emerald-500"></div><div class="absolute top-0 w-3 h-3 rounded-full bg-emerald-500"></div><div class="absolute top-0 w-3 h-3 rounded-full bg-emerald-500"></div><div class="absolute top-0 w-3 h-3 rounded-full bg-emerald-500"></div></div>
                    </div>
                    <div id="analysisResults" class="hidden mt-8 space-y-8 animate-fade"></div>
                </div>
            </section>

            <!-- MODE: GAME -->
            <section id="gameSection" class="hidden animate-slide">
                <div class="bg-white p-8 card-custom border border-emerald-50 text-center">
                    <div id="gameStartScreen">
                        <div class="text-6xl mb-6">üéØ</div>
                        <h2 class="text-2xl font-black text-slate-900 mb-8 uppercase tracking-tighter text-emerald-900">Arena Tantangan AI</h2>
                        <div class="grid grid-cols-1 gap-4 max-w-sm mx-auto">
                            <button onclick="startGame('vocabulary')" class="px-8 py-5 bg-emerald-600 text-white rounded-3xl font-bold text-xs uppercase tracking-widest hover:bg-emerald-700 transition-all">üìñ Kosakata</button>
                            <button onclick="startGame('nahwu')" class="px-8 py-5 bg-blue-600 text-white rounded-3xl font-bold text-xs uppercase tracking-widest hover:bg-blue-700 transition-all">‚öñÔ∏è Nahwu</button>
                            <button onclick="startGame('sharaf')" class="px-8 py-5 bg-purple-600 text-white rounded-3xl font-bold text-xs uppercase tracking-widest hover:bg-purple-700 transition-all">üîÑ Sharaf</button>
                        </div>
                    </div>
                    <div id="gamePlayScreen" class="hidden">
                        <div class="flex justify-between items-center mb-8 border-b pb-4 border-slate-50">
                            <span id="currentCategoryBadge" class="text-[9px] font-black bg-emerald-50 text-emerald-700 px-3 py-1 rounded-full uppercase tracking-widest">...</span>
                            <span class="text-[10px] font-black text-slate-400 tracking-wider uppercase">Poin: <span id="gameScore" class="text-emerald-600">0</span></span>
                        </div>
                        <div id="gameQuestionText" class="text-2xl md:text-3xl font-bold text-emerald-950 arabic-font px-4 mb-10 leading-relaxed">...</div>
                        <div id="gameOptions" class="grid grid-cols-1 gap-3"></div>
                    </div>
                    <div id="gameResultScreen" class="hidden">
                        <div class="text-4xl font-black text-slate-400 mb-2 uppercase tracking-widest">Skor Akhir</div>
                        <div class="text-8xl font-black text-emerald-600 mb-8" id="finalScore">0</div>
                        <button onclick="showStartScreen()" class="px-12 py-5 bg-emerald-600 text-white rounded-full font-black text-xs uppercase shadow-2xl hover:bg-emerald-700 transition-all">Main Lagi</button>
                    </div>
                </div>
            </section>

            <!-- MODE: HELP -->
            <section id="helpSection" class="hidden animate-slide">
                <div class="bg-white p-8 card-custom border border-emerald-50 space-y-8 text-sm text-slate-600">
                    <div class="text-center">
                        <div class="text-5xl mb-4">‚ùì</div>
                        <h2 class="text-2xl font-black text-slate-900 uppercase tracking-tighter">Panduan Pengguna</h2>
                        <p class="text-slate-400 text-[10px] font-bold uppercase mt-1 tracking-widest">Pusat Bantuan Az-Zawawi v1</p>
                    </div>
                    
                    <div class="space-y-4 text-left">
                        <div class="p-6 bg-slate-50/50 rounded-3xl border border-slate-100">
                            <h3 class="font-bold text-emerald-700 mb-2">üîç Mode Kamus</h3>
                            <p>Cari kata tunggal (Indo/Arab). Dapatkan arti, suara pelafalan, serta "Visual AI" untuk mempermudah hafalan Anda.</p>
                        </div>
                        <div class="p-6 bg-slate-50/50 rounded-3xl border border-slate-100">
                            <h3 class="font-bold text-emerald-700 mb-2">üî¨ Bedah Kalimat</h3>
                            <p>Tulis kalimat utuh. AI akan menerjemahkan ke padanan Arab paling alami dan membedah posisi Nahwu & pola Sharaf per kata.</p>
                        </div>
                        <div class="p-6 bg-slate-50/50 rounded-3xl border border-slate-100">
                            <h3 class="font-bold text-emerald-700 mb-2">üïπÔ∏è Game Edukasi</h3>
                            <p>Latih kemampuan kosakata dan tata bahasa Anda dengan soal-soal interaktif yang dibangkitkan AI secara unik.</p>
                        </div>
                    </div>

                    <!-- FOOTER INSIDE HELP -->
                    <div class="pt-8 border-t border-slate-100 text-center">
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.3em] mb-4 text-center">Laporkan error ke:</p>
                        <a href="https://api.whatsapp.com/send?phone=6281297929294&text=%2A%23TanyaKamusArab%2A%0A%0AAssalamu%27alaikum%0A%0A" 
                           target="_blank" rel="noopener noreferrer"
                           class="inline-block px-10 py-5 bg-emerald-50 text-emerald-700 rounded-full font-black text-[11px] uppercase tracking-widest border-2 border-emerald-100 hover:bg-emerald-600 hover:text-white transition-all shadow-sm">
                           @2026 081297-ZAWAWI
                        </a>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- AUDIO SYSTEM -->
    <audio id="globalAudio" class="hidden"></audio>

    <script>
        const apiKey = ""; 
        let searchTimeout = null;
        let dictionary = [];
        let gameData = { questions: [], currentIndex: 0, score: 0, category: '' };

        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearchBtn');
        const resultArea = document.getElementById('resultArea');
        const aiStatus = document.getElementById('aiStatus');
        const emptyState = document.getElementById('emptyState');

        // NAVIGATION
        function switchMode(mode) {
            const sections = ['dictionarySection', 'analysisSection', 'gameSection', 'helpSection'];
            const buttons = ['btnNavDict', 'btnNavAnalysis', 'btnNavGame', 'btnNavHelp'];

            sections.forEach((s, i) => {
                const el = document.getElementById(s);
                const btn = document.getElementById(buttons[i]);
                if (s.startsWith(mode)) {
                    el.classList.remove('hidden');
                    btn.className = "px-6 py-2.5 rounded-xl text-[10px] font-black transition-all bg-emerald-600 text-white shadow-lg uppercase tracking-widest";
                } else {
                    el.classList.add('hidden');
                    btn.className = "px-6 py-2.5 rounded-xl text-[10px] font-black transition-all bg-white text-emerald-800 border border-emerald-100 uppercase tracking-widest";
                }
            });
            if (mode === 'game') showStartScreen();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // FEATURE: TTS
        async function playTTS(text) {
            if (!text) return;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Pelafalan fasih Arab: ${text}` }] }],
                        generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } } }
                    })
                });
                const data = await response.json();
                const base64 = data.candidates[0].content.parts[0].inlineData.data;
                const sampleRate = parseInt(data.candidates[0].content.parts[0].inlineData.mimeType.match(/rate=(\d+)/)?.[1] || "24000");
                const wav = pcmToWav(base64, sampleRate);
                const audio = document.getElementById('globalAudio');
                audio.src = URL.createObjectURL(wav); audio.play();
            } catch (e) { console.error(e); }
        }

        function pcmToWav(base64, rate) {
            const buffer = Uint8Array.from(atob(base64), c => c.charCodeAt(0)).buffer;
            const pcm = new Int16Array(buffer);
            const wav = new ArrayBuffer(44 + pcm.length * 2);
            const view = new DataView(wav);
            const writeStr = (off, s) => { for (let i = 0; i < s.length; i++) view.setUint8(off + i, s.charCodeAt(i)); };
            writeStr(0, 'RIFF'); view.setUint32(4, 36 + pcm.length * 2, true); writeStr(8, 'WAVE');
            writeStr(12, 'fmt '); view.setUint32(16, 16, true); view.setUint16(20, 1, true); view.setUint16(22, 1, true);
            view.setUint32(24, rate, true); view.setUint32(28, rate * 2, true); view.setUint16(32, 2, true);
            view.setUint16(34, 16, true); writeStr(36, 'data'); view.setUint32(40, pcm.length * 2, true);
            for (let i = 0; i < pcm.length; i++) view.setInt16(44 + i * 2, pcm[i], true);
            return new Blob([wav], { type: 'audio/wav' });
        }

        // FEATURE: VISUAL ISIM
        async function visualizeIsim(prompt, id) {
            const container = document.getElementById(id);
            container.innerHTML = `<div class="w-full h-44 bg-emerald-50 rounded-3xl flex items-center justify-center animate-pulse uppercase text-[9px] font-black text-emerald-600">Membangkitkan Visual...</div>`;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ instances: { prompt: `Realistic minimalist educational illustration of ${prompt}, white background` }, parameters: { sampleCount: 1 } })
                });
                const data = await response.json();
                container.innerHTML = `<img src="data:image/png;base64,${data.predictions[0].bytesBase64Encoded}" class="w-full h-44 object-cover rounded-3xl animate-fade">`;
            } catch (e) { container.innerHTML = `<p class='text-[8px] text-slate-400 p-4'>Gagal memuat visual.</p>`; }
        }

        // ANALYSIS SENTENCE (STRICT INDONESIAN)
        async function analyzeSentence() {
            const input = document.getElementById('sentenceInput').value.trim();
            if (input.length < 2) return;
            const resDiv = document.getElementById('analysisResults');
            const loader = document.getElementById('analysisLoader');
            resDiv.classList.add('hidden'); loader.classList.remove('hidden');
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: `Analisis kalimat v1: ${input}` }] }], systemInstruction: { parts: [{ text: `Kamu pakar linguistik Arab. Tugas: Terjemahkan ke Arab (jika input Indo) dan bedah Nahwu/Sharaf. WAJIB: Semua penjelasan dan catatan harus dalam Bahasa Indonesia. JANGAN gunakan bahasa Inggris. Output JSON: { "arabic_sentence": "...", "translation_note": "...", "breakdown": [{"word": "...", "role": "...", "note": "..."}] }` }] }, generationConfig: { responseMimeType: "application/json" } })
                });
                const data = await response.json();
                const analysis = JSON.parse(data.candidates[0].content.parts[0].text);
                renderAnalysis(analysis);
            } catch (e) { alert("AI v1 sedang sibuk."); } finally { loader.classList.add('hidden'); }
        }

        function renderAnalysis(data) {
            const res = document.getElementById('analysisResults');
            res.innerHTML = `
                <div class="p-8 bg-emerald-50 rounded-[2.5rem] border border-emerald-100 text-right animate-slide" dir="rtl">
                    <button onclick="playTTS('${data.arabic_sentence}')" class="p-2.5 bg-white text-emerald-600 rounded-full shadow-md mb-4 hover:scale-110 transition-transform"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M11 5L6 9H2v2h4l5 4V5zM14.5 10c0-1.38-.84-2.57-2.03-3.11v6.22c1.19-.54 2.03-1.73 2.03-3.11z"/></svg></button>
                    <p class="arabic-font text-3xl md:text-4xl font-bold text-emerald-950">${data.arabic_sentence}</p>
                    <p class="mt-6 text-xs text-slate-600 font-medium italic text-left" dir="ltr">"${data.translation_note}"</p>
                </div>
                <div class="space-y-4">
                    ${data.breakdown.map((b, i) => `
                        <div class="bg-white p-5 rounded-3xl border border-slate-100 flex flex-row-reverse items-center gap-6 shadow-sm hover:border-emerald-200 transition-all animate-slide" style="animation-delay: ${i*0.1}s">
                            <div class="arabic-font text-3xl font-bold text-emerald-900 w-20 text-center">${b.word}</div>
                            <div class="flex-1 text-right"><span class="px-3 py-1 bg-indigo-50 text-indigo-700 text-[8px] font-black uppercase rounded-lg tracking-widest border border-indigo-100">${b.role}</span><p class="text-xs text-slate-500 mt-2 font-medium leading-relaxed font-sans">${b.note}</p></div>
                        </div>
                    `).join('')}
                </div>
                <button onclick="copyAnalysis()" class="w-full py-5 bg-slate-900 text-white rounded-3xl font-black text-[10px] uppercase shadow-xl active:scale-95 transition-all">Salin Laporan Bedah</button>
            `;
            res.classList.remove('hidden');
        }

        function copyAnalysis() {
            const text = document.getElementById('analysisResults').innerText;
            const temp = document.createElement('textarea'); temp.value = text;
            document.body.appendChild(temp); temp.select(); document.execCommand('copy'); document.body.removeChild(temp);
            const btn = event.currentTarget; const old = btn.innerText; btn.innerText = "‚úÖ DATA TERSALIN";
            setTimeout(() => btn.innerText = old, 2000);
        }

        // GAMES LOGIC (STRICT INDO)
        function showStartScreen() { document.getElementById('gameStartScreen').classList.remove('hidden'); document.getElementById('gamePlayScreen').classList.add('hidden'); document.getElementById('gameResultScreen').classList.add('hidden'); }
        
        async function startGame(cat) {
            gameData.currentIndex = 0; gameData.score = 0;
            document.getElementById('gameStartScreen').classList.add('hidden'); document.getElementById('gamePlayScreen').classList.remove('hidden');
            document.getElementById('gameQuestionText').innerText = "Menyiapkan Sesi v1...";
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: `Generate 5 challenging MCQ for ${cat} Arabic v1. MUST use Indonesian for all options and explanations. No English.` }] }], systemInstruction: { parts: [{ text: `JSON array: [{"question": "...", "options": ["...", "...", "...", "..."], "correct": 0}]` }] }, generationConfig: { responseMimeType: "application/json" } })
                });
                const data = await response.json();
                gameData.questions = JSON.parse(data.candidates[0].content.parts[0].text);
                showQuestion();
            } catch (e) { showStartScreen(); }
        }

        function showQuestion() {
            const q = gameData.questions[gameData.currentIndex];
            document.getElementById('gameQuestionText').innerText = q.question;
            const opt = document.getElementById('gameOptions'); opt.innerHTML = "";
            q.options.forEach((o, i) => {
                const b = document.createElement('button'); b.className = "w-full p-5 rounded-[1.5rem] bg-slate-50 border-2 border-slate-100 text-slate-700 font-bold text-sm hover:border-emerald-500 transition-all text-left flex justify-between items-center";
                b.innerHTML = `<span>${o}</span> <span class="opacity-10 text-[10px]">OPSI ${i+1}</span>`;
                b.onclick = () => handleAnswer(i);
                opt.appendChild(b);
            });
        }

        function handleAnswer(idx) {
            const q = gameData.questions[gameData.currentIndex];
            const btns = document.getElementById('gameOptions').children;
            for(let b of btns) b.disabled = true;

            if (idx === q.correct) {
                btns[idx].classList.add('bg-emerald-100', 'border-emerald-500', 'text-emerald-900', 'scale-105');
                gameData.score += 20;
            } else {
                btns[idx].classList.add('bg-red-100', 'border-red-500', 'text-red-900');
                btns[q.correct].classList.add('bg-emerald-100', 'border-emerald-500');
            }
            
            updateGameUI();

            setTimeout(() => {
                gameData.currentIndex++;
                if (gameData.currentIndex < 5) {
                    showQuestion();
                } else {
                    document.getElementById('gamePlayScreen').classList.add('hidden');
                    document.getElementById('gameResultScreen').classList.remove('hidden');
                    document.getElementById('finalScore').innerText = gameData.score;
                }
            }, 1800);
        }

        function updateGameUI() { document.getElementById('gameScore').innerText = gameData.score; }

        // DICTIONARY (STRICT INDO)
        function clearSearch() { searchInput.value = ""; clearSearchBtn.classList.add('hidden'); resultArea.innerHTML = ""; emptyState.classList.remove('hidden'); searchInput.focus(); }
        async function handleSearch() {
            const q = searchInput.value.trim();
            clearSearchBtn.classList.toggle('hidden', q.length === 0);
            if (q.length < 2) { dictionary = []; resultArea.innerHTML = ""; emptyState.classList.remove('hidden'); return; }
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(async () => {
                aiStatus.classList.remove('hidden'); emptyState.classList.add('hidden'); resultArea.innerHTML = "";
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: `Search dictionary v1 for: ${q}. DEFINISI WAJIB BAHASA INDONESIA.` }] }], systemInstruction: { parts: [{ text: `Output JSON Array (Strictly INDONESIAN definitions): [{"type": "FIIL/ISIM", "arti": "...", "arabic": "...", "english_ref": "lion", "turunan": {"masdar": "...", "fail": "...", "maful": "...", "amr": "..."}}]` }] }, generationConfig: { responseMimeType: "application/json" } })
                    });
                    const data = await response.json(); dictionary = JSON.parse(data.candidates[0].content.parts[0].text);
                    dictionary.forEach((it, i) => {
                        const card = document.createElement('div'); card.className = "bg-white p-7 card-custom border border-slate-100 animate-slide hover:shadow-xl hover:border-emerald-200 transition-all";
                        const arb = it.arabic || "-";
                        card.innerHTML = `
                            <div class="flex justify-between items-start gap-4 mb-4">
                                <div class="flex-1"><span class="text-[8px] font-black bg-emerald-600 text-white px-2 py-0.5 rounded uppercase tracking-widest">${it.type} v1</span><h3 class="text-xl font-extrabold text-slate-800 mt-2">${it.arti}</h3></div>
                                <div class="flex flex-col items-end gap-2"><div class="arabic-font text-3xl font-bold text-emerald-950">${arb}</div><button onclick="playTTS('${arb}')" class="p-2.5 bg-emerald-50 text-emerald-600 rounded-full hover:scale-110 transition-transform"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M11 5L6 9H2v2h4l5 4V5zM14.5 10c0-1.38-.84-2.57-2.03-3.11v6.22c1.19-.54 2.03-1.73 2.03-3.11z"/></svg></button></div>
                            </div>
                            ${it.type === 'ISIM' ? `<div id="vis-${i}" class="mt-2"><button onclick="visualizeIsim('${it.english_ref || it.arti}', 'vis-${i}')" class="w-full py-3 bg-slate-50 text-slate-400 rounded-2xl text-[9px] font-black uppercase tracking-widest border border-dashed border-slate-200 hover:bg-emerald-50 hover:text-emerald-700 transition-all">Generate Visual AI</button></div>` : ''}
                            ${it.turunan ? `<div class="mt-6 pt-6 border-t border-slate-50 text-center grid grid-cols-2 md:grid-cols-4 gap-3" dir="rtl">
                                <div class="bg-slate-50/70 p-3 rounded-2xl"><p class="text-[7px] text-slate-400 font-black uppercase">Masdar</p><p class="arabic-font text-sm font-bold text-slate-800">${it.turunan.masdar || '-'}</p></div>
                                <div class="bg-slate-50/70 p-3 rounded-2xl"><p class="text-[7px] text-slate-400 font-black uppercase">Fail</p><p class="arabic-font text-sm font-bold text-slate-800">${it.turunan.fail || '-'}</p></div>
                                <div class="bg-amber-50/70 p-3 rounded-2xl"><p class="text-[7px] text-amber-500 font-black uppercase">Amr</p><p class="arabic-font text-sm font-bold text-amber-900">${it.turunan.amr || '-'}</p></div>
                                <div class="bg-emerald-50/70 p-3 rounded-2xl"><p class="text-[7px] text-emerald-500 font-black uppercase">Maful</p><p class="arabic-font text-sm font-bold text-emerald-900">${it.turunan.maful || '-'}</p></div>
                            </div>` : ''}
                        `;
                        resultArea.appendChild(card);
                    });
                } catch (e) { } finally { aiStatus.classList.add('hidden'); }
            }, 1000);
        }

        searchInput.addEventListener('input', handleSearch);
        window.onload = () => switchMode('dictionary');
    </script>
</body>
</html>